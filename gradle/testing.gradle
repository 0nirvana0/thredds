apply from: "$rootDir/gradle/dependencies.gradle"
apply plugin: "java"

dependencies {
    testCompile libraries["junit"]
}

tasks.withType(Test) {
//    // Disable tests globally for now.
//    // For subprojects that are okay to test, re-enable their individual test tasks in their build scripts.
//    setEnabled false

    if (!System.env['TRAVIS']) {
        ignoreFailures true
    }

//    // rootTestReport will include the results of this test.
//    // Parent projects are evaluated before their children, so this should be available.
//    rootProject.rootTestReport.reportOn it
//
//    // Generate a root report if there are any subproject reports.
//    finalizedBy rootProject.rootTestReport
}

// Add an SLF4J binding to testRuntime, if necessary.
afterEvaluate {
    if (testRuntimeHasDepNamed("slf4j-api")) {
        if (!testRuntimeHasDepNamed("slf4j-jdk14") && !testRuntimeHasDepNamed("log4j-slf4j-impl")) {
            dependencies.testRuntime libraries["slf4j-jdk14"]  // Default binding.
        }
    }
}

boolean testRuntimeHasDepNamed(String depName) {
    // Groovy truth: empty collections are coerced to false.
    configurations.testRuntime.allDependencies.findAll { it.name == depName }
}
