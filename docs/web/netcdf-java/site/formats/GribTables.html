<html>
<head>
<title>GRIB Tables</title>
<style type="text/css">
pre {font-size: 9pt; padding: 10px; background-color: #E7E7E7; border: 1px solid #CFCFCF; width: 85%;}
code {font-size: 11pt;}
dl {margin: 10px 5px 5px 15px;)
.style1 {font-style: italic}
</style>
</head>

<body>
<h1> GRIB Tables</h1>
<p>The following assumes that you want generic software like the netCDF-Java library to be able to correctly read the GRIB files that you write, or need to read.</p>
<p>In principle, if everything is done right, the reader ends up using the table that the writer used. In practice, there are many ways for that to fail. In order to increase the reliability of table-based file formats, I have <a href="http://www.unidata.ucar.edu/blogs/developer/en/entry/on_the_suitability_of_grib">proposed</a> a web registry of tables, which would create a unique id for each registered table. The writer would then embed the id into the GRIB or BUFR message (possibly in the &quot;local use&quot; section of GRIB-2, or  GRIB-1 octets &gt; 41 in PDS), and the reader could use the id to unambiguously retrieve the table from the web registry. Stay tuned for further details and a trial implementation.</p>
<p><strong>Contents:</strong>
</p>
<ul>
  <li><a href="#WriteGrib1">Writing Grib-1 Files</a></li>
  <li><a href="#ReadGrib1">Reading Grib-1 files with the CDM library</a></li>
  <li><a href="#DefineGrib1Params">XML Schema for defining Grib-1 Parameters</a></li>
</ul>
<hr>
<h2>Writing Grib-1 Files<a name="WriteGrib1"></a></h2>
<h3><strong>Encoding the center (octet 5) and subcenter id</strong> (octet 26)</h3>
<p>You must encode a center and subcenter id, in order for software to correctly match the tables used. If there is no subcenter in use,  use id =0 (&quot;no subcenter:), although 255 (&quot;missing&quot;) is acceptable but ambiguous. </p>
<h3><strong>Encoding the version number (octet 4)</strong></h3>
<p>If you are only using WMO standard tables (all parameter ids &lt; 128) then you should use version number = 1, 2, or 3, corresponding to the WMO standard table version.  The <a href="ftp://www.wmo.int/Documents/MediaPublic/Publications/CodesManual_WMO_no_306/WMO306_Vol_I.2_2010_en.pdf">Current WMO GRIB-1 table version</a> is 3. Using only parameters from the standard tables is best practice for the <em>international exchange</em> of GRIB messages.</p>
<p>If you are using non-standard (aka <em>local</em>) parameters, then you should use a version number in the range 128-254, which names your version of the tables. </p>
<h3><strong>Using local tables</strong></h3>
<p>If you  use local parameters, you must do the following:</p>
<ol>
  <li>You must own the center id, or own a subcenter id within the center, so that you can version your tables.</li>
  <li>You must correctly version your local table number. If your local table changes in a way that is not backwards compatible, you must change the version number. </li>
  <li>You must publish your local tables at some authoritative place, in a machine readable format. You must mantain these indefinitely. </li>
  <li>You must put the correct center, subcenter and version number into each GRIB message.</li>
</ol>
<p>Best practice for local table use includes the following:</p>
<ol>
  <li>Use a version number between 128-254.</li>
  <li>Do not override any entries in the WMO standard tables, ie, with parameter numbers less than 128.</li>
  <li>There is no one standard for publishing your tables, but any fixed column ASCII, CSV, or XML format is ok. In the US, many follow the <a href="ftp://ftp.cpc.ncep.noaa.gov/wd51we/wgrib/usertables.txt">NCEP table format</a>. Use the <a href="#XML_Schema">XML Schema for declaring Grib-1 Parameters</a> if you like XML. Do not use HTML, PDF, MS Word etc, since these are not machine readable formats.</li>
  <li>A parameter name is encouraged, as it makes the datasets more readable. However, <em>you must insure that your names are unique within any file that uses your table.</em></li>
  <li>Unidata encourages the use of <a href="http://www.unidata.ucar.edu/software/udunits/udunits-2/udunits2.html#Database">udunit formatting</a> for expressing units.</li>
  <li>We need to be able to find your tables. Add enough metadata so that a google search on &quot;&lt;your center name&gt; GRIB tables&quot; finds you within the first 2 pages. Send a link to netcdf-java@unidata.ucar.edu and we will link to you (and use your tables in the CDM library).</li>
</ol>
<hr WIDTH="100%">
<h2>Reading Grib-1<a name="ReadGrib1"></a> files with the CDM library version 4.3</h2>
<h3>Homogeneity requirements for collections of GRIB records</h3>
<p>The CDM library makes certain assumptions about collections of GRIB records, called <strong><em>homegeneity requirements</em></strong>:</p>
<ul>
  <li>The center, subcenter ids are assumed constant for all records. This effects which  tables are used, and also global attributes added to the fikle.</li>
  <li>The table version may differ across records.</li>
  <li>The reference dates may differ across records.</li>
</ul>
<h3>Standard table mapping</h3>
<p>A <em>standard table</em> is a GRIB parameter table that is automatically used by the CDM.  A <em>standard table map</em> is an association of a standard table with a center/subcenter/version id. The CDM internally loads several table maps, which are searched for a match in order. You can view all the standard tables used by the CDM in ToolsUI, using the <strong>IOSP/GRIB-1/GRIB1-TABLES</strong> tab. A standard table map looks  like this:</p>
<blockquote>
  <pre># resources\grib1\lookupTables.txt

# cen sub version table
  0:	-1:	   -1:	dss/WMO_GRIB1.xml
  7:   -1:    -1:	wgrib/table2.htm
  9:   -1:   128:  noaa_rfc/params9-128.tab
 57:   -1:     2:	local/afwa.tab
 58:   42:     2:	local/af_2.tab
 60:   255:    2:	local/wrf_amps.wrf</pre>
</blockquote>
<ol>
  <li>Each row contains the center, subcenter and table version, and the table filename, with a colon (:) seperating the fields.</li>
  <li>The  center, subcenter and table ids are read from each GRIB record, and the list of tables is searched for a match. The first match is used. </li>
  <li>A &quot;-1&quot; for the subcenter or version id matches any id. </li>
  <li>Center 0 is the WMO standard table for a given version. In the above example, all versions of the WMO table are mapped to a single table in the file <em>resources/grib1/dss/WMO_GRIB1.xml</em>. </li>
  <li>If a table is not matched, the  WMO table with the matching version will be used. This effectively assumes that the GRIB file does not override any WMO parameter entries. You can change that  programatically via <strong>ucar.nc2.grib.grib1.Grib1ParamTable.setStrict(true); </strong>or in the <a href="../reference/RuntimeLoading.html#XML">RunTime configuration file</a> by adding<a name="strict"></a>
    <pre>&lt;grib1Table strict=&quot;true&quot;/&gt;</pre>
  If <strong>strict=true</strong>, when a table is not matched, the GRIB file will fail to open. At that point you will need to add the correct parameter table, as described below.</li>
  <li>The CDM can read GRIB parameter tables in several formats:
    <ul>
      <li><strong>A file ending in .xml:</strong> an ad-hoc <a href="DefineGrib1Params">XML format</a> we made up.an ad-hoc <a href="DefineGrib1Params">XML format</a> we made up.</li>
      <li><strong>A file ending in .tab:</strong> the <a href="ftp://ftp.cpc.ncep.noaa.gov/wd51we/wgrib/usertables.txt">format</a> that <a href="http://www.cpc.ncep.noaa.gov/products/wesley/wgrib.html">wgrib</a> uses.</li>
      <li><strong>A file starting with &quot;table_2_&quot; or &quot;local_table_2_&quot;</strong> : the format the <a href="http://www.ecmwf.int/products/data/software/grib.html">ECMWF software</a> uses. </li>
    </ul>
  </li>
</ol>
<h3>Adding to the standard table mapping</h3>
<p>When the CDM does not have a table for a  center, subcenter and table version that a GRIB file uses, you must track down the corrrect table and add it to the CDM at runtime. (Also, send it to us so we can include it in the next release). To add a table at runtime:</p>
<ol>
  <li>Use <a href="../reference/RuntimeLoading.html">Runtime Loading</a> to add your own table programmatically within your application, or by using the Runtime configuration file.</li>
  <li>Tables that are added at runtime take precedence over the standard tables, and are searched first in the order of being added.</li>
  <li>Parameters that are not present in your table are taken from the default WMO table, if they exist.</li>
  <li>Missing parameters are marked &quot;unknown&quot; in the variable name and units.</li>
</ol>
<h3>Specifying a table for a particular dataset</h3>
<p>Many  GRIB datasets have an incorrect center/subcenter/version id, which means that the CDM would read from a different table than the one used to write the file. In this case, you dont want to override the correct table in the table map, rather you want to fix the problem for just the incorrect dataset. Here are the ways that can be done:</p>
<blockquote>
  <h4>Directly embed table in NcML</h4>
  <p>You can directly embed the table in NcML, using the <a href="#DefineGrib1Params">XML Schema for declaring Grib-1 Parameters</a>. For example:</p>
  <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>&lt;netcdf xmlns="http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2" location="cldc.mean.grib1"&gt;<br>  &lt;parameterMap&gt;
    &lt;parameter code=&quot;2&quot;&gt;<br>      &lt;description&gt;Pressure reduced to MSL&lt;/description&gt;<br>      &lt;units&gt;Pa&lt;/units&gt;<br>      &lt;name&gt;PRMSL&lt;/name&gt;<br>    &lt;/parameter&gt;<br>    &lt;parameter code=&quot;3&quot;&gt;<br>      &lt;description&gt;Pressure tendency&lt;/description&gt;<br>      &lt;units&gt;Pa/s&lt;/units&gt;<br>      &lt;name&gt;PTEND&lt;/name&gt;<br>      &lt;CF&gt;tendency_of_air_pressure&lt;/CF&gt;<br>      &lt;GCMD&gt;EARTH SCIENCE &gt; Atmosphere &gt; Atmospheric Pressure &gt; Pressure Tendency&lt;/GCMD&gt;<br>    &lt;/parameter&gt;
    ...<br>  &lt;/parameterMap&gt;<br>&lt;/netcdf&gt;</pre>
  <h4>Reference to a Grib1 Parameter table in NcML</h4>
  <p>You can reference the table in NcML, with the table being in  any <a href="GribParameterFormats">GRIB parameter table format</a> that that CDM recognizes. To do so, you pass the string <strong>&quot;GribParameterTable=&lt;absolute file path to table&gt;&quot;</strong> in the iospParam attribute of the netcdf element:</p>
  <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>&lt;netcdf xmlns="http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2" location="cldc.mean.grib1"<br>  <strong>iospParam=&quot;GribParameterTable=/data/NCEP/grib1/version123.tab&quot;</strong>&gt;<br>&lt;/netcdf&gt;</pre>
  <h4></h4>
  <h4>Reference to a Grib1 Parameter table lookup in NcML</h4>
  <p>You can reference a <a href="tableMap">table map</a> in NcML by passing the string <strong>&quot;GribParameterTableLookup=&lt;absolute file path to table map&gt;&quot;</strong> in the iospParam attribute of the netcdf element:</p>
  <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>&lt;netcdf xmlns="http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2" location="cldc.mean.grib1"<br>  <strong>iospParam=&quot;GribParameterTableLookup=/data/NCEP/grib1/lookupTable.txt&quot;</strong>&gt;<br>&lt;/netcdf&gt;
</pre>
  <h4>Directly embed table in TDS configuration catalog (not implemented yet)</h4>
  <p>You can directly embed an XML table in a featureCollection element of type GRIB  in a TDS configuration catalog:</p>
  <pre>&lt;featureCollection name=&quot;NCEP-GFS-Global_0p5deg&quot; featureType=&quot;GRIB&quot; harvest=&quot;true&quot; path=&quot;grib/NCEP/GFS/Global_0p5deg&quot;&gt;
  &lt;collection spec=&quot;/NCEP/GFS/Global_0p5deg/GFS_Global_0p5deg_#yyyyMMdd_HHmm#.grib2$&quot;  name=&quot;GFS_Global_0p5deg&quot; /&gt;
  &lt;parameterMap&gt;
    &lt;parameter code=&quot;2&quot;&gt;<br>      &lt;description&gt;Pressure reduced to MSL&lt;/description&gt;<br>      &lt;units&gt;Pa&lt;/units&gt;<br>      &lt;name&gt;PRMSL&lt;/name&gt;<br>    &lt;/parameter&gt;<br>    &lt;parameter code=&quot;3&quot;&gt;<br>      &lt;description&gt;Pressure tendency&lt;/description&gt;<br>      &lt;units&gt;Pa/s&lt;/units&gt;<br>      &lt;name&gt;PTEND&lt;/name&gt;<br>      &lt;CF&gt;tendency_of_air_pressure&lt;/CF&gt;<br>      &lt;GCMD&gt;EARTH SCIENCE &gt; Atmosphere &gt; Atmospheric Pressure &gt; Pressure Tendency&lt;/GCMD&gt;<br>    &lt;/parameter&gt;
    ...<br>  &lt;/parameterMap&gt;
&lt;/featureCollection&gt;</pre>
  <h4>Reference a table in TDS configuration catalog (not implemented yet)</h4>
  <p>You can reference a table in a featureCollection element of type GRIB  in a TDS configuration catalog:</p>
  <pre>&lt;featureCollection name=&quot;NCEP-GFS-Global_0p5deg&quot; featureType=&quot;GRIB&quot; harvest=&quot;true&quot; path=&quot;grib/NCEP/GFS/Global_0p5deg&quot;&gt;
  &lt;collection spec=&quot;/NCEP/GFS/Global_0p5deg/GFS_Global_0p5deg_#yyyyMMdd_HHmm#.grib2$&quot;  name=&quot;GFS_Global_0p5deg&quot; /&gt;
  <strong>&lt;GribParameterTable path=&quot;/data/NCEP/grib1/version123.tab&quot;&gt;</strong>
&lt;/featureCollection&gt;</pre>
  <h4>Reference a table map in TDS configuration catalog (not implemented yet)</h4>
  <p>You can reference a table map in a featureCollection element of type GRIB  in a TDS configuration catalog:</p>
  <pre>&lt;featureCollection name=&quot;NCEP-GFS-Global_0p5deg&quot; featureType=&quot;GRIB&quot; harvest=&quot;true&quot; path=&quot;grib/NCEP/GFS/Global_0p5deg&quot;&gt;
  &lt;collection spec=&quot;/NCEP/GFS/Global_0p5deg/GFS_Global_0p5deg_#yyyyMMdd_HHmm#.grib2$&quot;  name=&quot;GFS_Global_0p5deg&quot; /&gt;
  <strong>&lt;GribParameterTableLookup path=&quot;/data/NCEP/grib1/lookupTable.txt&quot;&gt;</strong>
&lt;/featureCollection&gt;</pre>
  <p>&nbsp;</p>
</blockquote>
<hr WIDTH="100%">
<h2>XML Schema for defining Grib-1 Parameters<a name="DefineGrib1Params" id="DefineGrib1Params"></a></h2>
  <p>Derived from <a href="../reference/RuntimeLoading.html#XML">NCAR DSS format</a> with additional &quot;name&quot; element.</p>
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;xs:schema xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot; elementFormDefault=&quot;qualified&quot;&gt;<br>  &lt;xs:element name=&quot;parameterMap&quot;&gt;<br>    &lt;xs:complexType&gt;<br>      &lt;xs:sequence&gt;<br>        &lt;xs:element name=&quot;title&quot; type=&quot;xs:string&quot;/&gt;<br>        &lt;xs:element name=&quot;source&quot; type=&quot;xs:string&quot;/&gt;<br>		   &lt;xs:element maxOccurs=&quot;unbounded&quot; ref=&quot;parameter&quot;/&gt;<br>      &lt;/xs:sequence&gt;<br>    &lt;/xs:complexType&gt;<br>  &lt;/xs:element&gt;<br>

  &lt;xs:element name=&quot;parameter&quot;&gt;<br>    &lt;xs:complexType&gt;<br>      &lt;xs:sequence&gt;<br>        &lt;xs:element ref=&quot;description&quot;/&gt;<br>        &lt;xs:element minOccurs=&quot;0&quot; ref=&quot;units&quot;/&gt;<br>        &lt;xs:element minOccurs=&quot;0&quot; ref=&quot;name&quot;/&gt;<br>        &lt;xs:element minOccurs=&quot;0&quot; ref=&quot;CF&quot;/&gt;<br>        &lt;xs:element minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot; ref=&quot;GCMD&quot;/&gt;<br>      &lt;/xs:sequence&gt;<br>      &lt;xs:attribute name=&quot;code&quot; use=&quot;required&quot; type=&quot;xs:integer&quot;/&gt;<br>    &lt;/xs:complexType&gt;<br>  &lt;/xs:element&gt;<br>  
  &lt;xs:element name=&quot;description&quot; type=&quot;xs:string&quot;/&gt;<br>  &lt;xs:element name=&quot;units&quot; type=&quot;xs:string&quot;/&gt;<br>  &lt;xs:element name=&quot;name&quot; type=&quot;xs:string&quot;/&gt;<br>  &lt;xs:element name=&quot;CF&quot; type=&quot;xs:NCName&quot;/&gt;<br>  
  &lt;xs:element name=&quot;GCMD&quot;&gt;<br>    &lt;xs:complexType mixed=&quot;true&quot;&gt;<br>      &lt;xs:attribute name=&quot;ifLevelType&quot; type=&quot;xs:integer&quot;/&gt;<br>    &lt;/xs:complexType&gt;<br>  &lt;/xs:element&gt;<br>&lt;/xs:schema&gt;
    </pre>
<p> Example:<br>
    </p>
<pre>&lt;?xml version=&quot;1.0&quot; ?&gt;<br>



&lt;parameterMap&gt;<br>  &lt;title&gt;WMO GRIB1 Parameter Code Table 3&lt;/title&gt;<br>  &lt;source&gt;http://dss.ucar.edu/docs/formats/grib/gribdoc/params.html&lt;/source&gt;<br>  &lt;parameter code=&quot;1&quot;&gt;<br>    &lt;description&gt;Pressure&lt;/description&gt;<br>    &lt;units&gt;Pa&lt;/units&gt;<br>    &lt;name&gt;PRES&lt;/name&gt;<br>	   &lt;CF&gt;air_pressure&lt;/CF&gt;<br>    &lt;GCMD ifLevelType=&quot;1&quot;&gt;EARTH SCIENCE &gt; Atmosphere &gt; Atmospheric Pressure &gt; Surface Pressure&lt;/GCMD&gt;<br>    &lt;GCMD ifLevelType=&quot;2&quot;&gt;EARTH SCIENCE &gt; Atmosphere &gt; Clouds &gt; Cloud Base Pressure&lt;/GCMD&gt;<br>    &lt;GCMD ifLevelType=&quot;3&quot;&gt;EARTH SCIENCE &gt; Atmosphere &gt; Clouds &gt; Cloud Top Pressure&lt;/GCMD&gt;<br>    &lt;GCMD ifLevelType=&quot;7&quot;&gt;EARTH SCIENCE &gt; Atmosphere &gt; Altitude &gt; Tropopause&lt;/GCMD&gt;<br>    &lt;GCMD ifLevelType=&quot;102&quot;&gt;EARTH SCIENCE &gt; Atmosphere &gt; Atmospheric Pressure &gt; Sea Level Pressure&lt;/GCMD&gt;<br>    &lt;GCMD&gt;EARTH SCIENCE &gt; Atmosphere &gt; Atmospheric Pressure &gt; Hydrostatic Pressure&lt;/GCMD&gt;<br>  &lt;/parameter&gt;<br>  &lt;parameter code=&quot;2&quot;&gt;<br>    &lt;description&gt;Pressure reduced to MSL&lt;/description&gt;<br>    &lt;units&gt;Pa&lt;/units&gt;<br>    &lt;name&gt;PRMSL&lt;/name&gt;<br>  &lt;/parameter&gt;<br>  &lt;parameter code=&quot;3&quot;&gt;<br>    &lt;description&gt;Pressure tendency&lt;/description&gt;<br>    &lt;units&gt;Pa/s&lt;/units&gt;<br>    &lt;name&gt;PTEND&lt;/name&gt;<br>    &lt;CF&gt;tendency_of_air_pressure&lt;/CF&gt;<br>    &lt;GCMD&gt;EARTH SCIENCE &gt; Atmosphere &gt; Atmospheric Pressure &gt; Pressure Tendency&lt;/GCMD&gt;<br>  &lt;/parameter&gt;<br>  &lt;parameter code=&quot;4&quot;&gt;<br>    &lt;description&gt;Potential vorticity&lt;/description&gt;<br>    &lt;units&gt;K.m2.kg-1.s-1&lt;/units&gt;<br>    &lt;name&gt;PVORT&lt;/name&gt;<br>    &lt;CF&gt;ertel_potential_vorticity&lt;/CF&gt;<br>    &lt;GCMD&gt;EARTH SCIENCE &gt; Atmosphere &gt; Atmospheric Winds &gt; Vorticity&lt;/GCMD&gt;<br>  &lt;/parameter&gt;<br>  &lt;parameter code=&quot;5&quot;&gt;<br>    &lt;description&gt;ICAO Standard Atmosphere reference height&lt;/description&gt;<br>    &lt;units&gt;m&lt;/units&gt;<br>    &lt;name&gt;ICAHT&lt;/name&gt;<br>  &lt;/parameter&gt;
   ...

&lt;/parameterMap&gt;</pre>
<hr WIDTH="100%">
<h2>Reading Grib-2<a name="ReadGrib2" id="ReadGrib2"></a> files with the CDM library version 4.3 (incomplete)</h2>
<h3>Homogeneity requirements for collections of GRIB records</h3>
<p>The CDM library makes certain assumtions about collections of GRIB records, called <strong><em>homegeneity requirements</em></strong>:</p>
<ul>
  <li>The center, subcenter ids are assumed constant for all records.</li>
  <li>The table version may differ across records.</li>
  <li>The reference dates may differ across records.</li>
</ul>
<h3>Constructing CDM Variables from collections of GRIB records</h3>
<p>The CDM library takes unordered collections of GRIB records and groups them into 3D or 4D CDM Variables with a time and optional vertical dimension. It uses the following GRIB fields to construct a unique variable:</p>
<ul>
  <li>Discipline (octet 7 of Indicator section)</li>
  <li>Category (octet 10 of PDS)</li>
  <li>Parameter (octet 11 of PDS)</li>
  <li>Level-1 Type (eg octet 23 of PDS template 0)</li>
  <li>is a vertical layer (Level-2 Type exists) (eg octet 29 of PDS template 0)</li>
  <li>Statistical process Type for time averages (PDS templates 8-14) (eg octet 47 of PDS template 8)</li>
  <li>Ensemble derived Type (PDS templates 2-4)  (eg octet 35 of PDS template 2)</li>
  <li>Probability Type (octet 11 of PDS)</li>
  <li>GDS hashcode</li>
</ul>
<p>see <strong>ucar.nc2.grib.grib2.Grib2Record.cdmVariableHash()</strong> for exact definition.</p>
<hr WIDTH="100%">
<address>
<img src="../nc.gif" alt="" width="64" height="64"> This document is maintained by <a href="mailto:caron@unidata.ucar.edu">John Caron</a> and was last updated Nov 16, 2011
</address>
</body>
</html>
