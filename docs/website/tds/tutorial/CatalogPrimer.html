<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
    <title>Client Catalog Primer</title>
    <link rel="stylesheet" href="tutorial2.css" type="text/css"/>
    <script type="text/javascript" src="workshopNav.js"></script>
</head>

<body>
<h1> THREDDS Client Catalog Primer </h1>

<div id="section">
    <h2><a name="context">What This Section Covers</a></h2>

    <div id="note" class="info">
        <h4>Reference documentation</h4>

        <p>The <a href="../catalog/InvCatalogSpec.html">annotated schema</a> is the best complete description of THREDDS
            catalogs.</p>
    </div>

    <p>A <em><strong>THREDDS Catalog</strong></em> describes what datasets a server has, and how they can be accessed.
        A catalog is an <a href="http://www.w3.org/TR/REC-xml/">XML</a> document that follows the THREDDS Catalog
        schema. </p>

    <p>This section will describe the <em><strong>client</strong></em> view of the catalog. If you are maintaining a TDS
        <em>server</em>, you will also need to add other information to the catalog,
        which is used only by the server and is not seen by the client.</p>

    <ul>
        <li><a href="#Basics">Basics</a></li>
        <li><a href="#Nested_datasets">Nested datasets</a></li>
        <li><a href="#More_dataset_information">More dataset information</a></li>
        <li><a href="#Factoring_out_information">Factoring out information</a></li>
        <li><a href="#Catalog_references">Catalog references</a></li>
        <li><a href="#Shared_service_name">Shared service name</a></li>
        <li><a href="#Constructing_an_access_URL">Constructing an access URL</a></li>
        <li><a href="#Compound_service_elements">Compound <code>service</code> elements</a></li>
        <li><a href="#XML_validation">XML validation</a></li>
        <li><a href="#Using_ToolsUI">Using ToolsUI to view catalogs</a></li>
    </ul>
</div>

<div id="section">
    <h2><a name="Basics">Basics</a></h2>

    <p>Here's an example of a simple catalog:</p>

<pre>
1) &lt;?xml version=&quot;1.0&quot; ?&gt;
2) &lt;<strong>catalog</strong> <strong>xmlns</strong>=&quot;http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0&quot; &gt;
3)   &lt;<strong>service</strong> name=&quot;<strong>dodsServer</strong>&quot; serviceType=&quot;<strong>OpenDAP</strong>&quot; base=&quot;<strong>/thredds/dodsC/</strong>&quot; /&gt;
4)   &lt;<strong>dataset</strong> name=&quot;SAGE III Ozone Loss for Oct 31 2006&quot; serviceName=&quot;<strong>dodsServer</strong>&quot; urlPath=&quot;<strong>sage/110312006.nc</strong>&quot;/&gt;
5) &lt;/<strong>catalog</strong>&gt;
</pre>

    <p>with this line-by-line explanation:</p>

    <ol>
        <li>The first line indicates that the text is an XML document.</li>
        <li>This is the root element of the XML, the <code>catalog</code> element. It must declare the <em>thredds
            catalog
            namespace</em> with the <code>xmlns</code> attribute exactly as shown.
        </li>
        <li>This declares a <em>service</em> with name <code>dodsServer</code>.
            It is a OpenDAP service whose dataset URLs all start with <code>/thredds/dodsC/</code>. This is what is
            called a
            <em>relative URL</em>, and
            is <em>resolved</em> against the catalog URL. If the catalog URL is, for example,
            <code>http://thredds.ucar.edu/thredds/Sage/catalog.html,</code> then the service base will resolve to <code>http://thredds.ucar.edu/thredds/dodsC/</code>.
        </li>
        <li>This declares a <code>dataset</code> whose name is <em>SAGE III Ozone Loss for Oct 31 2006</em>. It
            references
            the <code>dodsServer</code>
            service, and its access URL will be
            <code>http://thredds.ucar.edu/thredds/dodsC/<strong>sage/010312006.nc</strong></code>.
        </li>
        <li>This closes the catalog element.</li>
    </ol>
</div>

<div id="section">
    <h2><a name="Nested_datasets">Nested datasets</a></h2>

    <p>When you have many datasets to declare in each catalog, use
        nested datasets:</p>

<pre>
  &lt;?xml version=&quot;1.0&quot; ?&gt;
  &lt;catalog xmlns=&quot;http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0&quot; &gt;
    &lt;service name=&quot;dodsServer&quot; serviceType=&quot;OpenDAP&quot;  base=&quot;/thredds/dodsC/&quot; /&gt;

1)  &lt;<strong>dataset</strong> name=&quot;SAGE III Ozone Loss Experiment&quot; &gt;
2)    &lt;dataset name=&quot;January Averages&quot; serviceName=&quot;dodsServer&quot; urlPath=&quot;sage/avg/jan.nc&quot;/&gt;
2)    &lt;dataset name=&quot;February Averages&quot; serviceName=&quot;dodsServer&quot; urlPath=&quot;sage/avg/feb.nc&quot;/&gt;
2)    &lt;dataset name=&quot;March Averages&quot; serviceName=&quot;dodsServer&quot; urlPath=&quot;sage/avg/mar.nc&quot;/&gt;
3)  &lt;/<strong>dataset</strong>&gt;
  &lt;/catalog&gt;
</pre>

    <ol>
        <li>This declares a <em><strong>collection dataset</strong></em> which just
            acts as a container for the other datasets. Note that it ends in a <code>&gt;</code> instead
            of <code>/&gt;</code>, and does not have a <code>urlPath</code> attribute.
        </li>
        <li>These are the datasets that directly point to data, called <strong><em>direct
            datasets</em></strong>.
        </li>
        <li>This closes the collection dataset element on line 1.
        </li>
    </ol>

    <p>You can add any level of nesting you want, e.g.:</p>

<pre>
&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;catalog name=&quot;Example&quot; xmlns=&quot;http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0&quot; &gt;
 &lt;service name=&quot;dodsServer&quot; serviceType=&quot;OpenDAP&quot;  base=&quot;/thredds/dodsC/&quot; /&gt;

 &lt;dataset name=&quot;SAGE III Ozone Loss Experiment&quot; &gt;

  &lt;dataset name=&quot;Monthly Averages&quot; &gt;
   &lt;dataset name=&quot;January Averages&quot; serviceName=&quot;dodsServer&quot; urlPath=&quot;sage/avg/jan.nc&quot;/&gt;
   &lt;dataset name=&quot;February Averages&quot; serviceName=&quot;dodsServer&quot; urlPath=&quot;sage/avg/feb.nc&quot;/&gt;
   &lt;dataset name=&quot;March Averages&quot; serviceName=&quot;dodsServer&quot; urlPath=&quot;sage/avg/mar.nc&quot;/&gt;
  &lt;/dataset&gt;

  &lt;dataset name=&quot;Daily Flight Data&quot; &gt;
   &lt;dataset name=&quot;January&quot;&gt;
     &lt;dataset name=&quot;Jan 1, 2001&quot; serviceName=&quot;dodsServer&quot; urlPath=&quot;sage/daily/20010101.nc&quot;/&gt;
     &lt;dataset name=&quot;Jan 2, 2001&quot; serviceName=&quot;dodsServer&quot; urlPath=&quot;sage/daily/20010201.nc&quot;/&gt;
   &lt;/dataset&gt;
  &lt;/dataset&gt;

 &lt;/dataset&gt;
&lt;/catalog&gt;
</pre>
</div>

<div id="section">
    <h2><a name="More_dataset_information">More dataset information</a></h2>

    <p>There's a lot of other information that can be optionally added that helps
        applications and digital libraries know how to &quot;do the right thing&quot;
        with the dataset. The <code>collectionType</code> attribute is used on collection
        datasets. The <code>dataType</code> is a simple classification (e.g. <code>Image</code>,
        <code>Grid</code>, <code>Point</code> data, etc). The <code>dataFormatType</code>
        describes what format the data is stored in (e.g. <code>NetCDF</code>, <code>HDF5</code>,
        etc) used by a file transfer protocol like FTP. The combination of the naming
        <code>authority</code> and the <code>ID</code> attributes should form a globally unique identifier for a dataset.
        In the TDS, it is especially important to add <code>ID</code> attributes to your datasets.</p>

<pre>
&lt;dataset name=&quot;SAGE III Ozone Loss Experiment&quot; <strong>collectionType=&quot;TimeSeries&quot;</strong>&gt;
  &lt;dataset name=&quot;January Averages&quot; serviceName=&quot;aggServer&quot; urlPath=&quot;sage/avg/jan.nc&quot;
      <strong>authority=&quot;unidata.ucar.edu&quot; ID=&quot;sage-20938483&quot;</strong>&gt;
    &lt;<strong>dataType</strong>&gt;Trajectory&lt;/<strong>dataType</strong>&gt;
    &lt;<strong>dataFormatType</strong>&gt;NetCDF&lt;/<strong>dataFormatType</strong>&gt;
  &lt;/dataset&gt;
&lt;/dataset&gt;
</pre>

    <p>The <code>harvest</code> attribute indicates that the dataset is at the
        right level of granularity to be exported to search systems like Digital Libraries.
        Elements such as <code>summary</code>, <code>rights</code>, and <code>publisher</code>
        are needed in order to create valid entries for these services. For
        more details, see <a href="../reference/DLexport.html">Exporting THREDDS Datasets to Digital Libraries.</a> Also
        see the <a href="../catalog/InvCatalogSpec.html">Catalog Specification</a> as a complete reference.</p>

<pre>&lt;dataset name=&quot;SAGE III Ozone Loss Experiment&quot; <strong>harvest=&quot;true&quot;</strong>&gt;
  &lt;<strong>contributor</strong> role=&quot;data manager&quot;&gt;John Smith&lt;/contributor&gt;<br>  &lt;<strong>keyword</strong>&gt;Atmospheric Chemistry&lt;/keyword&gt;<br>  &lt;<strong>publisher</strong>&gt;<br>    &lt;name vocabulary=&quot;DIF&quot;&gt;Community Data Portal, National Center for Atmospheric Research, University Corporation for Atmospheric Research&lt;/long_name&gt;
    &lt;contact url=&quot;http://dataportal.ucar.edu&quot; email=&quot;cdp@ucar.edu&quot;/&gt;<br>  &lt;/<strong>publisher</strong>&gt;<br>&lt;/dataset&gt;</pre>
</div>

<div id="section">
    <h2><a name="Factoring_out_information">Factoring out information</a></h2>

    <p>Rather than declare the same information on each dataset, you can use the <em>metadata</em>
        element to factor out common information:</p>

<pre>
  &lt;<strong>dataset</strong> name=&quot;SAGE III Ozone Loss Experiment&quot; &gt;
1)  &lt;<strong>metadata inherit=&quot;true&quot;</strong>&gt;
2)    &lt;serviceName&gt;dodsServer&lt;/serviceName&gt;
2)    &lt;dataType&gt;Trajectory&lt;/dataType&gt;
2)    &lt;dataFormatType&gt;NetCDF&lt;/dataFormatType&gt;
2)    &lt;authority&gt;unidata.ucar.edu&lt;/authority&gt;
    &lt;<strong>/metadata</strong>&gt;

3)  &lt;dataset name=&quot;January Averages&quot; urlPath=&quot;sage/avg/jan.nc&quot; ID=&quot;sage-23487382&quot;/&gt;
3)  &lt;dataset name=&quot;February Averages&quot; urlPath=&quot;sage/avg/feb.nc&quot; ID=&quot;sage-63656446&quot;/&gt;
4)  &lt;dataset name=&quot;Global Averages&quot; urlPath=&quot;sage/global.nc&quot; ID=&quot;sage-7869700g&quot; <strong>dataType=&quot;Grid&quot;</strong>/&gt;
  &lt;/<strong>dataset</strong>&gt;
</pre>

    <ol>
        <li> The <code>metadata</code> element with <code>inherit="true"</code> implies that all
            the information inside the metadata element applies to the current dataset
            and all nested datasets.
        </li>
        <li>The <code>serviceName</code>, <code>dataType</code>, <code>dataFormatType</code> and <code>authority</code>
            are declared as elements.
        </li>
        <li>These datasets use all the metadata values declared in the parent dataset.</li>
        <li>This dataset uses 3 out of 4 of the metadata values declared in the parent dataset; it overrides
            <code>dataType</code>.
        </li>
    </ol>
</div>

<div id="section">
    <h2><a name="Catalog_references">Catalog references</a></h2>

    <p>It is very useful to break up large catalogs into pieces and separately
        maintain each piece. One way to do this is to build each piece as a separate
        and logically complete catalog, then create a master catalog using catalog references:</p>

<pre>
  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
  &lt;catalog xmlns=&quot;http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0&quot; name=&quot;Top Catalog&quot;
1)    <strong>xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;</strong>&gt;
2)  &lt;dataset name=&quot;Realtime data from IDD&quot;&gt;
3)    &lt;<strong>catalogRef</strong> <strong>xlink:href</strong>=&quot;idd/models.xml&quot; <strong>xlink:title</strong>=&quot;NCEP Model Data&quot; name=&quot;&quot; /&gt;
      &lt;<strong>catalogRef</strong> xlink:href=&quot;idd/radars.xml&quot; xlink:title=&quot;NEXRAD Radar&quot; name=&quot;&quot; /&gt;
      &lt;<strong>catalogRef</strong> xlink:href=&quot;idd/obsData.xml&quot; xlink:title=&quot;Station Data&quot; name=&quot;&quot; /&gt;
      &lt;<strong>catalogRef</strong> xlink:href=&quot;idd/satellite.xml&quot; xlink:title=&quot;Satellite Data&quot; name=&quot;&quot; /&gt;
    &lt;/dataset&gt;
  &lt;/catalog&gt;
</pre>

    <ol>
        <li>We declare the <strong>xlink namespace</strong> in the catalog element.</li>
        <li>The <em>collection</em> (or <em>container</em>) dataset logically contains the <code>catalogRefs</code>,
            which are thought of as nested datasets whose contents are the contents of the external catalog.
        </li>
        <li>Here are several <code>catalogRef</code> elements, each with a link to an external catalog,
            using the <code>xlink:href</code> attribute.
            The <code>xlink:title</code> is used as the name of the dataset. We need a name attribute (in order to
            validate, for obscure reasons), but it is
            ignored. The <code>xlink:href</code> attributes are relative URLS and are resolved against the catalog
            URL. If the catalog URL is, for example, <code>http://thredds.ucar.edu/thredds/data/catalog.xml</code>,
            then the resolved URL of the first catalogRef will be <code>http://thredds.ucar.edu/thredds/data/idd/models.xml</code>.
        </li>
    </ol>
</div>

<div id="section">
    <h2><a name="Shared_service_name">Shared service name</a></h2>
<pre>
  &lt;?xml version='1.0' encoding='UTF-8'?&gt;
  &lt;catalog xmlns="http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0"
      xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0.2"&gt;
    &lt;service name="odap" serviceType="OPENDAP" base="/thredds/dodsC/" /&gt;
    &lt;dataset name="TDS Tutorial: example 2"&gt;
      &lt;metadata <strong>inherited</strong>="true"&gt;
1)       &lt;serviceName&gt;<strong>odap</strong>&lt;/serviceName&gt;
      &lt;/metadata&gt;
2)    &lt;dataset name="TDS Tutorial: example data 1" urlPath="test/example1.nc" /&gt;
2)    &lt;dataset name="TDS Tutorial: example data 2" urlPath="test/example2.nc" /&gt;
2)    &lt;dataset name="TDS Tutorial: example data 3" urlPath="test/example3.nc" /&gt;
      &lt;catalogRef xlink:title="My Other Catalog"
                  xlink:href="myOtherCatalog.xml" /&gt;
      &lt;catalogRef xlink:title="Far Away Univ catalog"
                  xlink:href="http://www.farAwayU.edu/thredds/catalog.xml" /&gt;
    &lt;/dataset&gt;
  &lt;/catalog&gt;</pre>

    <ol>
        <li>The <code>serviceName</code> element is <em>inherited</em> by each child dataset from
            the containing dataset (direct datasets, <strong>NOT</strong> the <code>catalogRef</code>'s).
        </li>
        <li>These three child datasets all inherit the <code>odap</code> service name.</li>
    </ol>
</div>

<div id="section">
    <h2><a name="Constructing_an_access_URL">Constructing an access URL</a></h2>

    <p>Using the catalog directly above, and the dataset with <code>urlPath="test/example3.nc"</code>, here are the
        steps for client software to construct a dataset access URL:</p>

    <ol>
        <li>Find the service element referenced by the dataset:
            <pre>&lt;service name="odap" serviceType="OPENDAP" base="<strong>/thredds/dodsC/</strong>" /&gt;</pre>
        </li>
        <li>Get the base URL of the service element:
            <pre>/thredds/dodsC/</pre>
        </li>
        <li>If it is a relative URL, use the catalog's URL:
            <pre><strong>http://hostname:port</strong>/thredds/catalog.xml      <var>// Catalog URL</var></pre>
            to resolve the base URL:
            <pre>http://hostname:port/thredds/dodsC/           <var>// Service base URL</var></pre>
        </li>
        <li>Find the <code>urlPath</code> attribute for the accessible dataset:
            <pre>&lt;dataset name="TDS Tutorial: example data 3" urlPath="<strong>test/example3.nc</strong>" &gt;</pre>
        </li>
        <li>Append the value of the <code>urlPath</code> attribute to the base service URL:
<pre>
http://hostname:port/thredds/dodsC/test/example3.nc
|                   |             |                |
|&lt;---  server   ---&gt;|&lt;-----------&gt;|&lt;--------------&gt;|
                            |             |
          service basePath -|             |- dataset urlPath
</pre>
        </li>
    </ol>
</div>

<div id="section">
    <h2><a name="Compound_service_elements">Compound <code>service</code> elements</a></h2>

    <p>Datasets can be made available through more than one access
        method by defining and then referencing a <strong>compound</strong> <code>service</code> element. The following:
    </p>

<pre>
&lt;service name="<strong>all</strong>" serviceType="Compound" base="" &gt;
  &lt;service name="odap" serviceType="OpenDAP" base="/thredds/dodsC/" /&gt;
  &lt;service name="wcs" serviceType="WCS" base="/thredds/wcs/" /&gt;
&lt;/service&gt;
</pre>

    <p>defines a compound service named <code>all</code> which contains two
        nested services. Any dataset that reference the compound service will
        have two access methods. For instance:<br>
    </p>

<pre>
&lt;dataset name="cool data" urlPath="so/cool/data.nc" &gt;
  &lt;serviceName&gt;<strong>all</strong>&lt;/serviceName&gt;
&lt;/dataset&gt;
</pre>

    <p>would result in these two access URLs, open for OpenDAP access and one for WCS access:<br></p>

    <pre>/thredds/dodsC/so/cool/data.nc</pre>

    <pre>/thredds/wcs/so/cool/data.nc</pre>

    <p>Note: the contained services can still be referenced independently. For instance:</p>

<pre>
&lt;dataset name="more cool data" urlPath="more/cool/data.nc" &gt;
  &lt;serviceName&gt;odap&lt;/serviceName&gt;
&lt;/dataset&gt;
</pre>

    <p>results in a single access URL:</p>

    <pre>/thredds/dodsC/more/cool/data.nc</pre>

    Note:
    <ul>
        <li>The catalog specification provides a <a href="../catalog/InvCatalogSpec.html#serviceTypes">list of
            recognized
            service types</a>.
        </li>
        <li>The service names must be unique in each catalog</li>
    </ul>
</div>

<div id="section">
    <h2><a name="XML_validation">XML validation</a></h2>

    <p>If you use elements from other namespaces, you must declare those namespaces
        in the catalog element. Currently there are two other namespaces THREDDS libraries
        will recognize, <strong>Dublin Core</strong>, and <strong>XLink</strong>, whose
        namespaces look like:</p>

<pre>
&lt;catalog name=&quot;MyName&quot; xmlns=&quot;http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0&quot;
    <strong>xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot;</strong>
    <strong>xmlns:xlink="http://www.w3.org/1999/xlink"</strong> &gt;
</pre>

    <p>Its not obvious, but namespaces are not web addresses, they are just strings
        that need to be copied exactly as you see them here.</p>

    <p>As catalogs get more complicated, you should check that you haven't made any
        errors. There are three parts to checking: </p>
    <ol>
        <li>Is the XML well-formed?</li>
        <li>Is it valid against the catalog schema?</li>
        <li>Does it have everything it needs to be read by a THREDDS client?</li>
    </ol>
    <p>You can use a THREDDS validation service, such as <a
            href="http://motherlode.ucar.edu:8080/thredds/remoteCatalogValidation.html">this
        one</a> to check all three of these. </p>

    <p>You can check <em>well-formedness</em> using online tools like <a href="http://www.xmlvalidation.com/">this</a>.
        If
        you also want
        to check <em>validity</em> in those tools, you will need to declare the catalog
        schema location like this:</p>

<pre>
&lt;catalog name=&quot;MyName&quot; xmlns=&quot;http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0&quot;
1)  <strong>xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</strong>
2)  <strong>xsi:schemaLocation=&quot;http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0
    http://www.unidata.ucar.edu/schemas/thredds/InvCatalog.1.0.6.xsd&quot;</strong> &gt;
  ...
&lt;/catalog&gt;
</pre>

    <ol>
        <li>This line declares the schema-instance namespace. Just copy it exactly as
            you see it here.
        </li>
        <li> This line tells your XML validation tool where to find the THREDDS XML schema document.
            Just copy it exactly as you see it here.
        </li>
    </ol>
    <p>The THREDDS validation service, as well as the catalog
        library, knows where the schemas are located, so you only need to add these
        2 lines if you want to do your own validation.</p>

    <p>You will want to study the <a href="../catalog/InvCatalogSpec.html">annotated schema</a>, and the
        <a href="http://www.unidata.ucar.edu/schemas/thredds/InvCatalog.1.0.6.xsd">schema document </a>itself.</p>
</div>

<div id="section">
    <h2><a name="Using_ToolsUI">Using ToolsUI to view catalogs</a></h2>

    <p>The NetCDF Tools User Interface (aka ToolsUI) can read and display THREDDS catalogs. You can start it from the
        command line, or
        <a href="http://www.unidata.ucar.edu/software/thredds/current/netcdf-java/webstart/netCDFtools.jnlp">launch it
            from webstart</a>. Use the THREDDS Tab, and click on the
        <img src="images/fileIcon.jpg" width="31" height="29"> button to navigate to a local catalog file, or enter in
        the URL of a remote catalog, as below
        <em>(note that this is an XML document, not an HTML page!</em>). The catalog will be displayed in a tree widget
        on the left, and the selected dataset will be shown on the right, for example: </p>

    <a href="images/TUIthreddsTab.png"><img src="images/TUIthreddsTab.png" width="300" alt="ToolsUI"></a>

    <p>Once you get your catalog working in a TDS, you can enter the TDS URL directly, and view the datasets with the
        <strong>Open</strong> buttons. </p>
</div>

</body>
</html>
