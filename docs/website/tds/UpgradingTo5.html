<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>Upgrading To TDS 4.5</title>
  <link rel="stylesheet" href="tds.css" type="text/css">
</head>
<body>
<h1><img alt="Unidata" src="images/unidataLogo.png" align="middle" height="75" width="75"> Upgrading To TDS version 5</h1>

<hr>
<h2>Requirements</h2>
<ul>
  <li>Java 8 is now required (?)</li>
  <li>Tomcat 7 (servlet 3.0)</li>
</ul>
<h2>API Changes</h2>
<h3>Catalogs</h3>
<ul>
  <li>All uses of classes in <strong>thredds.catalog.*</strong> are deprecated. If you still need, you must add <strong>legacy.jar</strong> to your path.</li>
  <li>TDS and CDM now use<strong> thredds.server.catalog.*</strong> and <strong>thredds.client.catalog.*</strong></li>
</ul>
<h3>Viewers</h3>
<ul>
  <li><strong>thredds.servlet.Viewer </strong>has<strong> InvDatasetImpl </strong>changed to<strong> Dataset</strong></li>
  <li><strong>thredds.servlet.ViewerLinkProvider </strong>has<strong> InvDatasetImpl </strong>changed to<strong> Dataset</strong></li>
  <li><strong>thredds.server.viewer.dataservice.ViewerService </strong>has<strong> InvDatasetImpl </strong>changed to<strong> Dataset</strong></li>
</ul>
<h3>Coordinate Systems</h3>
<ul>
  <li>    <strong>ucar.nc2.dataset.CoordTransBuilderIF </strong>is split into     <strong>ucar.nc2.dataset.builder.HorizTransformBuilderIF</strong> and <strong>ucar.nc2.dataset.builder.VertTransformBuilderIF</strong></li>
  <li><strong>HorizTransformBuilderIF </strong>now uses <strong>AttributeContainer</strong>
    instead of <strong>NetcdfDataset, Variable</strong>
    <ul>
      <li><em>CoordinateTransform&#32;makeCoordinateTransform(NetcdfDataset&#32;ds,&#32;Variable&#32;ctv)</em> is now <em>ProjectionCT
        ma</em><em>keCoordinateTransform(AttributeContainer&#32;ctv)
      </em></li>
    </ul>
  </li>
  <li>Previously, the optional <strong>false_easting</strong><em><strong><a name="false_easting"></a>, </strong></em>and<em><strong> false_northing</strong></em> should match the units
  of the x and y projection coordinates</li>
</ul>
<h3>Feature Types</h3>
<ul>
  <li> <strong>ucar.nc2.dt.TypedDatasetFactory </strong>has been removed. Use <strong>ucar.nc2.ft.FeatureDatasetFactoryManager.</strong></li>
</ul>
<h3>Unsigned Types</h3>
<ul>
  <li><strong>DataType</strong> now has unsigned types: UBYTE, USHORT, UINT, ULONG</li>
  <li>Array,    ArrayScalar,  ArrayByte, ArrayInt, ArrayShort, ArrayLong factory and constructor methods now require isUnsigned parameter. </li>
  <li>Array.factory(class, shape) -&gt; Array.factory(DataType, shape) or Array.factory(dataType, class, shape)</li>
  <li>Array.get1DJavaArray(Class) -&gt; Array.get1DJavaArray(DataType) or Array.get1DJavaArray(Class, isUnsigned)</li>
  <li>remove Array.setUnsigned(), Variable.setUnsigned() </li>
  <li>Variable.getUnsigned() -&gt; Variable.getDataType().getUnsigned() </li>
  <li>    Attribute(String&#32;name,&#32;List&#32;values) -&gt; Attribute(String&#32;name,&#32;List&#32;values,&#32;boolean&#32;isUnsigned) </li>
  <li>StructureDataScalar.addMember(    String&#32;name,&#32;String&#32;desc,&#32;String&#32;units,&#32;DataType&#32;dtype,&#32;boolean isUnsigned, Number&#32;val  ) -&gt; StructureDataScalar.addMember(    String&#32;name,&#32;String&#32;desc,&#32;String&#32;units,&#32;DataType&#32;dtype,&#32;Number&#32;val  ) -&gt; </li>
</ul>
<h2>Catalog Schema changes</h2>
<p>Schema version is now 1.2</p>
<h3>Server Configuration Catalog</h3>
<ul>
  <li>the <strong>catalogScan</strong> element is now available</li>
  <li>the <strong>datasetFmrc</strong> element is no longer supported in a configCatalog</li>
</ul>
<h3>Client Catalogs</h3>
<ul>
  <li><strong>service</strong> elements may not be nested inside of <strong>dataset</strong> elements, they must be directly contained in the <strong>catalog</strong> element</li>
  <li><strong>datasetRoot</strong> elements may not be contained inside of <strong>service</strong> elements, they must be directly contained in the <strong>catalog</strong> element</li>
</ul>
<h3>DatasetScan</h3>
<ul>
  <li><strong>addID</strong> is no longer needed, ids are always added</li>
  <li><strong>addDatasetSizeElement</strong> is no longer needed, the dataset size is always added</li>
  <li><strong>sort: </strong>by default, datasets at each collection level are listed
  in ascending order by filename</li>
  <li><strong>User pluggable classes implementing UserImplType</strong> (crawlableDatasetImpl, crawlableDatasetFilterImpl, crawlableDatasetLabelerImpl, crawlableDatasetSorterImpl) are no longer supported. This was never officially released or documented.</li>
  <li>details are <a href="catalog/InvCatalogServerSpec.html">here</a></li>
</ul>
<h3>FeatureCollection</h3>
<ul>
  <li>standard service elements are used, user specified ones are ignored (?)</li>
</ul>
<h2>ThreddsConfig.xml</h2>
<ul>
  <li>Control over Catalog Caching is different, now you can control how many catalogs are cached, rather than turning caching on or off. So the following is no longer used, see <a href="reference/ThreddsConfigXMLFile.html#CatalogCaching">here</a> for the new syntax:
<pre>
&lt;Catalog&gt;
  &lt;cache&gt;false&lt;/cache&gt;
&lt;/Catalog&gt;
</pre></li>
  <li></li>
</ul>
<h2>New Features in version 5 ??</h2>
<ul>
  <li>TDS
    <ul>
      <li>Point Feature Collections (point, stations) now handled by Netcdf Subset Service.</li>
      <li>Automatic Metadata Extraction from the dataset into the thredds catalogs, on point collections only but will extend to other collections.</li>
      <li>NCSS Station data can output WaterML (beta).</li>
      <li>NCSS Point can output NetCDF-4/CF.</li>
    </ul>
  </li>
  <li>NcML
    <ul>
      <li> updated to implement full extended model.</li>
      <li> logicalReduce allows you to remove length 1 dimensions [<a href="https://bugtracking.unidata.ucar.edu/browse/TDS-267">TDS-267</a>].</li>
      <li>NcML handles multichar separators.</li>
    </ul>
  </li>
  <li>CDM
    <ul>
      <li>add Albers Equal Area projection</li>
      <li>add Geostationary projection (Tom Rink SSEC)</li>
      <li>CFPointWriter refactored, can write to netCDF-4</li>
      <li>CFGridWriter2 replaces CFGridWriter</li>
    </ul>
  </li>
  <li>IOSPs
  </li>
  <ul>
    <li><a href="../netcdf-java/reference/netcdf4Clibrary.html#writing">Netcdf-4 writing</a> improved, default chunking improved.</li>
    <li>GRIB: yet another rewrite of Grib Collections to allow scaling to very large collections.</li>
    <li>Improved HDF-EOS processing.</li>
    <li>CF 1.6 DSG: bug in handling station profiles, multidimensional representation [<a href="ftp://ftp.unidata.ucar.edu/pub/thredds/4.4/current/thredds.war">TDS-513</a>]</li>
    <li>MSGnavigation scan mode bug</li>
    <li>IOSP for SIGMET radar files (beta)</li>
  </ul>
  <li>GRIB
    <ul>
      <li>ECMWF DRS 50002 added by <a href="mailto:jkaehler@meteomatics.com">jkaehler@meteomatics.com</a></li>
    </ul>
  </li>
  <li>ToolsUI 
  </li>
  <ul>
    <li>using new Swing Look and Feel</li>
    <li>table columns can be set by user (upper right button on header line)</li>
    <li>File Chooser improvements</li>
    <li></li>
  </ul>
</ul>
<h3>&nbsp;</h3>
<h3>Internal changes</h3>
<ul>
  <li><strong>HttpClient</strong> library upgraded to 4.2, previously was 3.</li>
  <li>We are now using <strong>log4j2</strong>. The configuration file is in <strong>{tomcat}/webapps/thredds//WEB-INF/classes/log4j2.xml</strong>. See <a href="http://logging.apache.org/log4j/2.x/">http://logging.apache.org/log4j/2.x/</a></li>
  <li> Most services have been converted to <a href="http://docs.spring.io/spring/docs/3.0.x/reference/mvc.html">annotated Spring controllers</a>. Documentation on adding your own service is coming soon.</li>
  <li>Point dataset unit tests upgraded to CF 1.6.</li>
  <li>    Unit testing framework now complete; 2700+ unit tests.</li>
  <li><a href="https://scan.coverity.com/projects/388?tab=overview">Covarity</a> static analysis now being done. 3000+ defects eliminated, about 1000 to go.</li>
  <li>Code being converted to use Java 7 constructs, eg try-with-resources, generics.</li>
</ul>
<p>&nbsp;</p>
<hr>

<address>
  <img src="thread.png" alt="TDS" height="108" width="110">This document is maintained by Unidata and was
  last updated May 2015. Send comments to <a href="mailto:support-thredds@unidata.ucar.edu">THREDDS
  support</a>.
</address>

</body>
</html>
