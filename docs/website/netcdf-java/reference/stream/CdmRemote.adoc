= CDM Remote Web Service
:tdsDocs: ../../../tds/reference/services

CDM Remote is a web service implemented in the CDM library (client) and TDS (server), providing remote access to CDM datasets, using
link:NcStream.html[ncstream] as the on-the-wire protocol. It provides access at the NetcdfFile and FeatureDataset levels of the CDM API, so there are
two levels of services:

1.  *CdmRemote* provides index subsetting on remote CDM datasets, with the same functionality that *NetcdfFile* provides for
CDM local datasets and *DODSNetcdfFile* provides for remote OPeNDAP datasets. CdmRemote supports the full CDM data model.
2.  *link:CdmrFeature.adoc[CdmrFeature]* provides coordinate subsetting on remote CDM Feature Datasets, with similar functionality to WCS and
Unidata's link:{tdsDocs}/NetcdfSubsetServiceReference.html[NetCDF Subset Service] (NCSS). This API and protocol is redone
in version 5.0.

The CDM Remote services and protocol are experimental and should not be used outside of the CDM stack for now.

'''''

== CdmRemote Protocol (Index space Data Access)

The client forms requests of the form **endpoint?query**. The possible query parameters are:

---------------------------------------------------------------
  req=( CDL | NcML | capabilities | header | data)
  var=vars
where:
  vars := varspec | varspec[';' varspec]
  varspec := varname[subsetSpec]
  varname := escaped variable name
  subsetSpec := '(' fortran-90 arraySpec ')'

  fortran-90 arraySpec := dim | dim ',' dims
  dim := ':' | slice | start ':' end | start ':' end ':' stride
  slice := INTEGER
  start := INTEGER
  stride := INTEGER
  end := INTEGER
---------------------------------------------------------------

* Request parameter values are case-insensitive
* The var parameter is only used for data requests (req=data)
* The variable names are case-sensitive and must be link:../../CDM/Identifiers.html#cdmremote[backslash-escaped]
* Nonterminals are in lower case, terminals are in upper case, literals are in single quotes.
* Optional components are enclosed between square braces '[' and ']'.

Example service requests are:

[width="100%",cols="50%,50%",options="header",]
|======================================================================================================================
|Request |Response
|http://server:8080/thredds/cdmremote/data.nc?**req=CDL** |dataset CDL
|http://server:8080/thredds/cdmremote/data.nc?**req=NcML** |dataset NcML
|http://server:8080/thredds/cdmremote/data.nc?**req=capabilities** |capabilities XML
|http://server:8080/thredds/cdmremote/data.nc?**req=header** |header ncstream message, contains the structural metadata
|http://server:8080/thredds/cdmremote/data.nc?**req=data&var=Temp(0:99:10,0:127,:);lat;lon** |ncstream data message
|======================================================================================================================

* Data request uses Section specification (same as Fortran-90 array notation) to ask for a subset in index space.
* Variable names are case-sensitive and must be link:../../CDM/Identifiers.html#cdmremote[backslash-escaped]

=== Capabilities

[source,xml]
-----------------------------------------------------------------------------------------------------------------
<cdmRemoteCapabilities location="http://localhost:8080/thredds/cdmremote/testAll/testdata/2004050300_eta_211.nc">
  <featureDataset url="http://localhost:8080/thredds/cdmremote/testAll/testdata/2004050300_eta_211.nc" />
</cdmRemoteCapabilities>
-----------------------------------------------------------------------------------------------------------------

=== Responses

* CDL and NcML responses show the structural metadata of the dataset in CDL and NcML
* Capabilities response indicates which (if any) feature types the dataset can be opened as, along with the URLs of those services. The Capabilities
response is a simple ad-hoc XML format. Not sure if we need this.
* The header and data reponses are described by the link:NcStreamGrammer.html[ncstream Grammer.] You need a client library that can parse protobuf
messages.

== Client libraries

=== Java

*ucar.nc2.stream.CdmRemote* is a subclass of *NetcdfFile* which provides index subsetting on remote CDM datasets.
*NetcdfDataset.openOrAcquireFile()* sees the _cdmremote:url_ prefix, and instantiates a *CdmRemote* object. The url must be an endpoint for a _cdmremote_ service.
ToolsUI now preferentially uses _cdmremote_ service when it is available.

* upon opening, *req=header* is called and the NetcdfFile objects are read from the response
* when data is requested, and the data are not already stored locally (immediate mode), then *req=data* is called.
* from the client POV, the dataset is exactly the same as any other *NetcdfFile*.

CDM datasets can also be serialized and stored in a disk file, and then read as a "normal" netCDF file by the CDM library. In this sense *ncstream*
becomes another format for NetCDF files, alongside netCDF-3 and netCDF-4.

* *CdmRemote.writeToFile()* will serialize an entire remote dataset to a file.
* *ucar.nc2.stream.NcStreamIosp* is an IOSP that can read ncstream disk files.

Python
^^^^^^

* coming soon +

'''''

image:../../nc.gif[image] This document was last updated October 2015

Â 
